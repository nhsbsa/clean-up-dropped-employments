{% extends 'layout.html' %}
{% set pageTitle = "John Smith"%}

{% block pageTitle %}
{{pageTitle}} - {{serviceName}}
{% endblock %}

{% block content %}
<div class="nhsuk-grid-row">
    <div class="nhsuk-grid-column-full">

        <span class="nhsuk-caption-l">Member Details</span>
        <h1 class="nhsuk-heading-l nhsuk-u-margin-bottom-3">{{pageTitle}}</h1>
    
        <div class="nhsuk-grid-row">
          <div class="nhsuk-grid-column-one-half">
            {{ summaryList({
            rows: [
            {
            key: {
            text: "Member number"
            },
            value: {
            text: "12345678"
            }
            },
            {
            key: {
            text: "NI number"
            },
            value: {
            text: "QQ 12 34 45 D"
            }
            },
            {
            key: {
            text: "Scheme"
            },
            value: {
            html: "2015 Scheme"
            }
            }
            ]
            }) }}
          </div>
          <div class="nhsuk-grid-column-one-half">
            {{ summaryList({
            rows: [
            {
            key: {
            text: "Date of birth (Age)"
            },
            value: {
            text: "18 September 1959 (66year 02month)"
            }
            },
            {
            key: {
            text: "Status"
            },
            value: {
            html: "Active"
            }
            },
            {
            key: {
            text: "Email"
            },
            value: {
            html: 'john.smith@email.com'
            }
            }
            ]
            }) }}
          </div>
        </div>
    
        <!-- ****************
            OVERVIEW
          ***************** -->
    
        {% set notifyHtml %}
        <p>
          <b>8 validation issues</b> have been found for member 12345678
        </p>
        {% endset %}
    
        {{ insetText({
        html: notifyHtml
        }) }}
    
    
        <h2>Core member data sets</h2>
        <div class="nhsuk-hint" id="example-with-hint-text-hint">
            <p>These data sets show core member details from Compendia. You can cross-reference them in one view.</p>
            <p>Any issues are highlighted and must be fixed before the case can be processed.</p>
        </div>

        <button class="nhsuk-button nhsuk-button--secondary" aria-expanded="false" aria-controls="filters-panel" id="filters-toggle">
          Show filters
        </button>

        <div id="filters-panel" hidden>
            <form id="table-selector-form">
              <div class="nhsuk-form-group">
                <fieldset class="nhsuk-fieldset">
                  <legend class="nhsuk-fieldset__legend--m">
                    Choose which data sets to display
                  </legend>
            
                  <div class="nhsuk-checkboxes">
            
                    <div class="nhsuk-checkboxes__item">
                      <input class="nhsuk-checkboxes__input" id="serviceHistory-checkbox" name="tables" type="checkbox" value="serviceHistory" checked>
                      <label class="nhsuk-label nhsuk-checkboxes__label" for="serviceHistory-checkbox">
                        Service history
                      </label>
                    </div>
            
                    <div class="nhsuk-checkboxes__item">
                      <input class="nhsuk-checkboxes__input" id="serviceGroup-checkbox" name="tables" type="checkbox" value="serviceGroup" checked>
                      <label class="nhsuk-label nhsuk-checkboxes__label" for="serviceGroup-checkbox">
                        Service group
                      </label>
                    </div>
            
                    <div class="nhsuk-checkboxes__item">
                      <input class="nhsuk-checkboxes__input" id="employmentHistory-checkbox" name="tables" type="checkbox" value="employmentHistory" checked>
                      <label class="nhsuk-label nhsuk-checkboxes__label" for="employmentHistory-checkbox">
                        Employment History
                      </label>
                    </div>
            
                    <div class="nhsuk-checkboxes__item">
                      <input class="nhsuk-checkboxes__input" id="contsTpp-checkbox" name="tables" type="checkbox" value="contsTpp" checked>
                      <label class="nhsuk-label nhsuk-checkboxes__label" for="contsTpp-checkbox">
                        Conts &amp; TPP (Pension contributions)
                      </label>
                    </div>
            
                    <div class="nhsuk-checkboxes__item">
                      <input class="nhsuk-checkboxes__input" id="hoursHistory-checkbox" name="tables" type="checkbox" value="hoursHistory" checked>
                      <label class="nhsuk-label nhsuk-checkboxes__label" for="hoursHistory-checkbox">
                        Hours history
                      </label>
                    </div>
            
                    <div class="nhsuk-checkboxes__item">
                      <input class="nhsuk-checkboxes__input" id="linkedEmployment-checkbox" name="tables" type="checkbox" value="linkedEmployment" checked>
                      <label class="nhsuk-label nhsuk-checkboxes__label" for="linkedEmployment-checkbox">
                        Linked employment
                      </label>
                    </div>
            
                  </div>
                </fieldset>
              </div>
            
              <button class="nhsuk-button" type="submit">Apply filters</button>
            </form>
        </div>
        


       <!-- ****************
        SERVICE HISTORY
      ***************** -->

      <details class="nhsuk-details nhsuk-expander" id="serviceHistory">
        <summary class="nhsuk-details__summary">
          <span class="nhsuk-details__summary-text">
            Service history
          </span>
          <strong class="nhsuk-tag nhsuk-tag--red">
            4 issues found
          </strong>
        </summary>
        <div class="nhsuk-details__text">
            <div class="nhsuk-error-summary" aria-labelledby="error-summary-title" role="alert" tabindex="-1" data-module="nhsuk-error-summary">
                <h2 class="nhsuk-error-summary__title" id="error-summary-title">
                  Issues found
                </h2>
                <div class="nhsuk-error-summary__body">
                  <p>There are 4 issues in the service history table. They must be fixed before the record can be processed.</p>
                  <ul class="nhsuk-list nhsuk-error-summary__list" role="list">
                    <li> <a href="#shError">Employment ID 3 and employment ID 5 cannot start on the same day</a></li>
                    <li> <a href="#shError">Employment ID 3 end date missing</a></li>
                    <li> <a href="#shError">Employment ID 3 update date incorrect</a></li>
                    <li> <a href="#shError">Employment ID 5 start date incorrect</a></li>
                  </ul>
                </div>
            </div>
            <table class="nhsuk-table-responsive" role="table">
                <thead class="nhsuk-table__head" role="rowgroup">
                  <tr role="row">
                      <th scope="col" class="nhsuk-table__header nhsuk-u-font-size-14" role="columnheader">
                        <a href="?sort=empIdSH&direction={% if sort == 'empIdSH' and direction == 'asc' %}desc{% else %}asc{% endif %}" class="sortableLink">
                          Employment ID
                          {% if sort == "empIdSH" %}
                            {% if direction == "asc" %}
                              <span aria-hidden="true" class="sortable">
                                <svg width="22" height="22" focusable="false" aria-hidden="true" role="img" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                                  <path d="M6.5625 15.5L11 6.63125L15.4375 15.5H6.5625Z" fill="currentColor"></path>
                                </svg>
                              </span>
                            {% elseif direction == "desc" %}
                              <span aria-hidden="true" class="sortable">
                                <svg width="22" height="22" focusable="false" aria-hidden="true" role="img" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                                  <path d="M15.4375 7L11 15.8687L6.5625 7L15.4375 7Z" fill="currentColor"></path>
                                </svg>
                              </span>
                            {% endif %}
                          {% else %}
                              <span aria-hidden="true" class="sortable">
                                <svg width="22" height="22" focusable="false" aria-hidden="true" role="img" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                                  <path d="M8.1875 9.5L10.9609 3.95703L13.7344 9.5H8.1875Z" fill="currentColor"></path>
                                  <path d="M13.7344 12.0781L10.9609 17.6211L8.1875 12.0781H13.7344Z" fill="currentColor"></path>
                                </svg>
                              </span>
                          {% endif %}
                        </a>
                      </th>
                      <th scope="col" class="nhsuk-table__header nhsuk-u-font-size-14" role="columnheader">Scheme code</th>
                      <th scope="col" class="nhsuk-table__header nhsuk-u-font-size-14" role="columnheader">
                        <a href="?sort=startSH&direction={% if sort == 'startSH' and direction == 'asc' %}desc{% else %}asc{% endif %}" class="sortableLink">
                          Start date
                          {% if sort == "startSH" %}
                            {% if direction == "asc" %}
                              <span aria-hidden="true" class="sortable">
                                <svg width="22" height="22" focusable="false" aria-hidden="true" role="img" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                                  <path d="M6.5625 15.5L11 6.63125L15.4375 15.5H6.5625Z" fill="currentColor"></path>
                                </svg>
                              </span>
                            {% elseif direction == "desc" %}
                              <span aria-hidden="true" class="sortable">
                                <svg width="22" height="22" focusable="false" aria-hidden="true" role="img" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                                  <path d="M15.4375 7L11 15.8687L6.5625 7L15.4375 7Z" fill="currentColor"></path>
                                </svg>
                              </span>
                            {% endif %}
                          {% else %}
                              <span aria-hidden="true" class="sortable">
                                <svg width="22" height="22" focusable="false" aria-hidden="true" role="img" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                                  <path d="M8.1875 9.5L10.9609 3.95703L13.7344 9.5H8.1875Z" fill="currentColor"></path>
                                  <path d="M13.7344 12.0781L10.9609 17.6211L8.1875 12.0781H13.7344Z" fill="currentColor"></path>
                                </svg>
                              </span>
                          {% endif %}
                        </a>
                      </th>
                      <th scope="col" class="nhsuk-table__header nhsuk-u-font-size-14" role="columnheader">
                        <a href="?sort=endSH&direction={% if sort == 'endSH' and direction == 'asc' %}desc{% else %}asc{% endif %}" class="sortableLink">
                          End date
                          {% if sort == "endSH" %}
                            {% if direction == "asc" %}
                              <span aria-hidden="true" class="sortable">
                                <svg width="22" height="22" focusable="false" aria-hidden="true" role="img" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                                  <path d="M6.5625 15.5L11 6.63125L15.4375 15.5H6.5625Z" fill="currentColor"></path>
                                </svg>
                              </span>
                            {% elseif direction == "desc" %}
                              <span aria-hidden="true" class="sortable">
                                <svg width="22" height="22" focusable="false" aria-hidden="true" role="img" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                                  <path d="M15.4375 7L11 15.8687L6.5625 7L15.4375 7Z" fill="currentColor"></path>
                                </svg>
                              </span>
                            {% endif %}
                          {% else %}
                              <span aria-hidden="true" class="sortable">
                                <svg width="22" height="22" focusable="false" aria-hidden="true" role="img" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                                  <path d="M8.1875 9.5L10.9609 3.95703L13.7344 9.5H8.1875Z" fill="currentColor"></path>
                                  <path d="M13.7344 12.0781L10.9609 17.6211L8.1875 12.0781H13.7344Z" fill="currentColor"></path>
                                </svg>
                              </span>
                          {% endif %}
                        </a>
                      </th>
                      <th scope="col" class="nhsuk-table__header nhsuk-u-font-size-14" role="columnheader">Updated</th>
                      <th scope="col" class="nhsuk-table__header nhsuk-u-font-size-14" role="columnheader">Member status</th>
                      <th scope="col" class="nhsuk-table__header nhsuk-u-font-size-14" role="columnheader">End reason code</th>
                      <th scope="col" class="nhsuk-table__header nhsuk-u-font-size-14" role="columnheader">Group</th>
                  </tr>
                </thead>
                <tbody class="nhsuk-table__body">
                  {% for row in schemeHistoryData | sortBy(sort, direction) %}
                    <tr class="nhsuk-table__row {% if row.error %}errorHighlight{% else %}hidden-row{% endif %}" role="row">
                      <td class="nhsuk-table__cell nhsuk-u-font-size-14" role="cell">{{ row.empId }}</td>
                      <td class="nhsuk-table__cell nhsuk-u-font-size-14" role="cell">{{ row.scheme }}</td>
                      <td class="nhsuk-table__cell nhsuk-u-font-size-14" role="cell">
                        {% if row.error %}
                          <span class="errorTxt">{{ row.empId }}</span>
                        {% else %}
                          {{ row.start }}
                        {% endif %}
                      </td>
                      <td class="nhsuk-table__cell nhsuk-u-font-size-14" role="cell">{{ row.end }}</td>
                      <td class="nhsuk-table__cell nhsuk-u-font-size-14" role="cell">
                        {% if row.error %}
                            <span class="errorTxt">{{ row.empId }}</span>
                        {% else %}
                          {{ row.updated }}
                        {% endif %}
                      </td>
                      <td class="nhsuk-table__cell nhsuk-u-font-size-14" role="cell">{{ row.status }}</td>
                      <td class="nhsuk-table__cell nhsuk-u-font-size-14" role="cell">{{ row.endReason }}</td>
                      <td class="nhsuk-table__cell nhsuk-u-font-size-14" role="cell">{{ row.group }}</td>
                    </tr>
                  {% endfor %}
                </tbody>                
            </table>
        </div>
      </details>

      <!-- ****************
          SERVICE GROUP
        ***************** -->

      <details class="nhsuk-details nhsuk-expander" id="serviceGroup">
        <summary class="nhsuk-details__summary">
          <span class="nhsuk-details__summary-text">
            Service group
          </span>
        </summary>
        <div class="nhsuk-details__text">
            <table class="nhsuk-table-responsive" role="table">
                <thead class="nhsuk-table__head" role="rowgroup">
                  <tr role="row">
                      <th scope="col" class="nhsuk-table__header nhsuk-u-font-size-14" role="columnheader">
                        <a href="?sort=groupID&direction={% if sort == 'groupID' and direction == 'asc' %}desc{% else %}asc{% endif %}" class="sortableLink">
                          Group ID
                          {% if sort == "groupID" %}
                            {% if direction == "asc" %}
                              <span aria-hidden="true" class="sortable">
                                <svg width="22" height="22" focusable="false" aria-hidden="true" role="img" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                                  <path d="M6.5625 15.5L11 6.63125L15.4375 15.5H6.5625Z" fill="currentColor"></path>
                                </svg>
                              </span>
                            {% elseif direction == "desc" %}
                              <span aria-hidden="true" class="sortable">
                                <svg width="22" height="22" focusable="false" aria-hidden="true" role="img" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                                  <path d="M15.4375 7L11 15.8687L6.5625 7L15.4375 7Z" fill="currentColor"></path>
                                </svg>
                              </span>
                            {% endif %}
                          {% else %}
                              <span aria-hidden="true" class="sortable">
                                <svg width="22" height="22" focusable="false" aria-hidden="true" role="img" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                                  <path d="M8.1875 9.5L10.9609 3.95703L13.7344 9.5H8.1875Z" fill="currentColor"></path>
                                  <path d="M13.7344 12.0781L10.9609 17.6211L8.1875 12.0781H13.7344Z" fill="currentColor"></path>
                                </svg>
                              </span>
                          {% endif %}
                        </a>
                      </th>
                      <th scope="col" class="nhsuk-table__header nhsuk-u-font-size-14" role="columnheader">Scheme code</th>
                      <th scope="col" class="nhsuk-table__header nhsuk-u-font-size-14" role="columnheader">
                        <a href="?sort=startGrp&direction={% if sort == 'startGrp' and direction == 'asc' %}desc{% else %}asc{% endif %}" class="sortableLink">
                          Start date
                          {% if sort == "startGrp" %}
                            {% if direction == "asc" %}
                              <span aria-hidden="true" class="sortable">
                                <svg width="22" height="22" focusable="false" aria-hidden="true" role="img" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                                  <path d="M6.5625 15.5L11 6.63125L15.4375 15.5H6.5625Z" fill="currentColor"></path>
                                </svg>
                              </span>
                            {% elseif direction == "desc" %}
                              <span aria-hidden="true" class="sortable">
                                <svg width="22" height="22" focusable="false" aria-hidden="true" role="img" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                                  <path d="M15.4375 7L11 15.8687L6.5625 7L15.4375 7Z" fill="currentColor"></path>
                                </svg>
                              </span>
                            {% endif %}
                          {% else %}
                              <span aria-hidden="true" class="sortable">
                                <svg width="22" height="22" focusable="false" aria-hidden="true" role="img" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                                  <path d="M8.1875 9.5L10.9609 3.95703L13.7344 9.5H8.1875Z" fill="currentColor"></path>
                                  <path d="M13.7344 12.0781L10.9609 17.6211L8.1875 12.0781H13.7344Z" fill="currentColor"></path>
                                </svg>
                              </span>
                          {% endif %}
                        </a>
                      </th>
                      <th scope="col" class="nhsuk-table__header nhsuk-u-font-size-14" role="columnheader">
                        <a href="?sort=endGrp&direction={% if sort == 'endGrp' and direction == 'asc' %}desc{% else %}asc{% endif %}" class="sortableLink">
                          End date
                          {% if sort == "endGrp" %}
                            {% if direction == "asc" %}
                              <span aria-hidden="true" class="sortable">
                                <svg width="22" height="22" focusable="false" aria-hidden="true" role="img" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                                  <path d="M6.5625 15.5L11 6.63125L15.4375 15.5H6.5625Z" fill="currentColor"></path>
                                </svg>
                              </span>
                            {% elseif direction == "desc" %}
                              <span aria-hidden="true" class="sortable">
                                <svg width="22" height="22" focusable="false" aria-hidden="true" role="img" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                                  <path d="M15.4375 7L11 15.8687L6.5625 7L15.4375 7Z" fill="currentColor"></path>
                                </svg>
                              </span>
                            {% endif %}
                          {% else %}
                              <span aria-hidden="true" class="sortable">
                                <svg width="22" height="22" focusable="false" aria-hidden="true" role="img" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                                  <path d="M8.1875 9.5L10.9609 3.95703L13.7344 9.5H8.1875Z" fill="currentColor"></path>
                                  <path d="M13.7344 12.0781L10.9609 17.6211L8.1875 12.0781H13.7344Z" fill="currentColor"></path>
                                </svg>
                              </span>
                          {% endif %}
                        </a>
                      </th>
                      <th scope="col" class="nhsuk-table__header nhsuk-u-font-size-14" role="columnheader">Status</th>
                      <th scope="col" class="nhsuk-table__header nhsuk-u-font-size-14" role="columnheader">End reason code</th>
                  </tr>
                </thead>
                <tbody class="nhsuk-table__body">
                  {% for row in groupTableData | sortBy(sort, direction) %}
                    <tr class="nhsuk-table__row {% if row.error %}errorHighlight{% else %}hidden-row{% endif %}" role="row">
                      <td class="nhsuk-table__cell nhsuk-u-font-size-14" role="cell">{{ row.groupId }}</td>
                      <td class="nhsuk-table__cell nhsuk-u-font-size-14" role="cell">{{ row.scheme }}</td>
                      <td class="nhsuk-table__cell nhsuk-u-font-size-14" role="cell">{{ row.start }}</td>
                      <td class="nhsuk-table__cell nhsuk-u-font-size-14" role="cell">{{ row.end }}</td>
                      <td class="nhsuk-table__cell nhsuk-u-font-size-14" role="cell">{{ row.status }}</td>
                      <td class="nhsuk-table__cell nhsuk-u-font-size-14" role="cell">{{ row.endReason }}</td>
                    </tr>
                  {% endfor %}
                </tbody>
              </table>
        </div>
      </details>

    <!-- ****************
        EMPLOYMENT HISTORY
      ***************** -->

      <details class="nhsuk-details nhsuk-expander" id="employmentHistory">
        <summary class="nhsuk-details__summary">
          <span class="nhsuk-details__summary-text">
            Employment history
          </span>
          <strong class="nhsuk-tag nhsuk-tag--red">
            2 issues found
          </strong>
        </summary>
        <div class="nhsuk-details__text">
            <div class="nhsuk-error-summary" aria-labelledby="error-summary-title" role="alert" tabindex="-1" data-module="nhsuk-error-summary">
                <h2 class="nhsuk-error-summary__title" id="error-summary-title">
                  Issues found
                </h2>
                <div class="nhsuk-error-summary__body">
                  <p>There are 2 issues in the employment history table. They must be fixed before the record can be processed. </p>
                  <ul class="nhsuk-list nhsuk-error-summary__list" role="list">
                    <li> <a href="#ehError">Employment ID 3 must appear in both service history and employment history</a></li>
                    <li> <a href="#ehError">Employment ID 5 must appear in both service history and employment history</a></li>
                  </ul>
                </div>
            </div>
            <table class="nhsuk-table-responsive" role="table">
                <caption class="nhsuk-table__caption">Employment history</caption>
                <thead class="nhsuk-table__head" role="rowgroup">
                  <tr role="row">
                      <th scope="col" class="nhsuk-table__header nhsuk-u-font-size-14" role="columnheader">
                        <a href="?sort=empIdEH&direction={% if sort == 'empIdEH' and direction == 'asc' %}desc{% else %}asc{% endif %}" class="sortableLink">
                          Employment ID
                          {% if sort == "empIdEH" %}
                            {% if direction == "asc" %}
                              <span aria-hidden="true" class="sortable">
                                <svg width="22" height="22" focusable="false" aria-hidden="true" role="img" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                                  <path d="M6.5625 15.5L11 6.63125L15.4375 15.5H6.5625Z" fill="currentColor"></path>
                                </svg>
                              </span>
                            {% elseif direction == "desc" %}
                              <span aria-hidden="true" class="sortable">
                                <svg width="22" height="22" focusable="false" aria-hidden="true" role="img" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                                  <path d="M15.4375 7L11 15.8687L6.5625 7L15.4375 7Z" fill="currentColor"></path>
                                </svg>
                              </span>
                            {% endif %}
                          {% else %}
                              <span aria-hidden="true" class="sortable">
                                <svg width="22" height="22" focusable="false" aria-hidden="true" role="img" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                                  <path d="M8.1875 9.5L10.9609 3.95703L13.7344 9.5H8.1875Z" fill="currentColor"></path>
                                  <path d="M13.7344 12.0781L10.9609 17.6211L8.1875 12.0781H13.7344Z" fill="currentColor"></path>
                                </svg>
                              </span>
                          {% endif %}
                        </a>
                      </th>
                      <th scope="col" class="nhsuk-table__header nhsuk-u-font-size-14" role="columnheader">Employer code</th>
                      <th scope="col" class="nhsuk-table__header nhsuk-u-font-size-14" role="columnheader">
                        <a href="?sort=startEH&direction={% if sort == 'startEH' and direction == 'asc' %}desc{% else %}asc{% endif %}" class="sortableLink">
                          Start date
                          {% if sort == "startEH" %}
                            {% if direction == "asc" %}
                              <span aria-hidden="true" class="sortable">
                                <svg width="22" height="22" focusable="false" aria-hidden="true" role="img" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                                  <path d="M6.5625 15.5L11 6.63125L15.4375 15.5H6.5625Z" fill="currentColor"></path>
                                </svg>
                              </span>
                            {% elseif direction == "desc" %}
                              <span aria-hidden="true" class="sortable">
                                <svg width="22" height="22" focusable="false" aria-hidden="true" role="img" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                                  <path d="M15.4375 7L11 15.8687L6.5625 7L15.4375 7Z" fill="currentColor"></path>
                                </svg>
                              </span>
                            {% endif %}
                          {% else %}
                              <span aria-hidden="true" class="sortable">
                                <svg width="22" height="22" focusable="false" aria-hidden="true" role="img" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                                  <path d="M8.1875 9.5L10.9609 3.95703L13.7344 9.5H8.1875Z" fill="currentColor"></path>
                                  <path d="M13.7344 12.0781L10.9609 17.6211L8.1875 12.0781H13.7344Z" fill="currentColor"></path>
                                </svg>
                              </span>
                          {% endif %}
                        </a>
                      </th>
                      <th scope="col" class="nhsuk-table__header nhsuk-u-font-size-14" role="columnheader">
                        <a href="?sort=endEH&direction={% if sort == 'endEH' and direction == 'asc' %}desc{% else %}asc{% endif %}" class="sortableLink">
                          End date
                          {% if sort == "endEH" %}
                            {% if direction == "asc" %}
                              <span aria-hidden="true" class="sortable">
                                <svg width="22" height="22" focusable="false" aria-hidden="true" role="img" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                                  <path d="M6.5625 15.5L11 6.63125L15.4375 15.5H6.5625Z" fill="currentColor"></path>
                                </svg>
                              </span>
                            {% elseif direction == "desc" %}
                              <span aria-hidden="true" class="sortable">
                                <svg width="22" height="22" focusable="false" aria-hidden="true" role="img" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                                  <path d="M15.4375 7L11 15.8687L6.5625 7L15.4375 7Z" fill="currentColor"></path>
                                </svg>
                              </span>
                            {% endif %}
                          {% else %}
                              <span aria-hidden="true" class="sortable">
                                <svg width="22" height="22" focusable="false" aria-hidden="true" role="img" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                                  <path d="M8.1875 9.5L10.9609 3.95703L13.7344 9.5H8.1875Z" fill="currentColor"></path>
                                  <path d="M13.7344 12.0781L10.9609 17.6211L8.1875 12.0781H13.7344Z" fill="currentColor"></path>
                                </svg>
                              </span>
                          {% endif %}
                        </a>
                      </th>
                      <th scope="col" class="nhsuk-table__header nhsuk-u-font-size-14" role="columnheader">Whole/part time</th>
                      <th scope="col" class="nhsuk-table__header nhsuk-u-font-size-14" role="columnheader">Capacity code</th>
                      <th scope="col" class="nhsuk-table__header nhsuk-u-font-size-14" role="columnheader">Employment type</th>
                      <th scope="col" class="nhsuk-table__header nhsuk-u-font-size-14" role="columnheader">Actual hours</th>
                      <th scope="col" class="nhsuk-table__header nhsuk-u-font-size-14" role="columnheader">Standard hours</th>
                  </tr>
                </thead>
                <tbody class="nhsuk-table__body">
                  {% for row in tableDataEH | sortBy(sort, direction) %}
                    <tr class="nhsuk-table__row {% if row.error %}errorHighlight{% else %}hidden-row{% endif %}" role="row">
                      <td class="nhsuk-table__cell nhsuk-u-font-size-14" role="cell">{{ row.empId }}</td>
                      <td class="nhsuk-table__cell nhsuk-u-font-size-14" role="cell">{{ row.empCode }}</td>
                      <td class="nhsuk-table__cell nhsuk-u-font-size-14" role="cell">{{ row.start }}</td>
                      <td class="nhsuk-table__cell nhsuk-u-font-size-14" role="cell">{{ row.end }}</td>
                      <td class="nhsuk-table__cell nhsuk-u-font-size-14" role="cell">{{ row.wpt }}</td>
                      <td class="nhsuk-table__cell nhsuk-u-font-size-14" role="cell">{{ row.cap }}</td>
                      <td class="nhsuk-table__cell nhsuk-u-font-size-14" role="cell">{{ row.empType }}</td>
                      <td class="nhsuk-table__cell nhsuk-u-font-size-14" role="cell">{{ row.actual }}</td>
                      <td class="nhsuk-table__cell nhsuk-u-font-size-14" role="cell">{{ row.standard }}</td>
                    </tr>
                  {% endfor %}
                </tbody>
                
              </table>
        </div>
      </details>

        <!-- ****************
        PENSION CONTRIBUTIONS
        ***************** -->
        <details class="nhsuk-details nhsuk-expander" id="contsTpp">
            <summary class="nhsuk-details__summary">
                <span class="nhsuk-details__summary-text">
                    Conts &amp; TPP (Pension contributions)
                </span>
                <strong class="nhsuk-tag nhsuk-tag--red">
                    1 issue found
                </strong>
            </summary>
            <div class="nhsuk-details__text">
                <div class="nhsuk-error-summary" aria-labelledby="error-summary-title" role="alert" tabindex="-1"
                    data-module="nhsuk-error-summary">
                    <h2 class="nhsuk-error-summary__title" id="error-summary-title">
                        Issue found
                    </h2>
                    <div class="nhsuk-error-summary__body">
                        <p>There is 1 issue in the pension contributions table. They must be fixed before the record can
                            be processed. </p>
                        <ul class="nhsuk-list nhsuk-error-summary__list" role="list">
                            <li> <a href="#contsError">Employment ID 3 must appear in both service history and
                                    employment history</a></li>
                        </ul>
                    </div>
                </div>
                <button id="toggleButtonConts" class="nhsuk-button nhsuk-button--secondary" data-module="nhsuk-button" onclick="toggleRows()">Hide correct rows</button>
                <table  class="nhsuk-table-responsive" role="table">
                  <thead class="nhsuk-table__head" role="rowgroup">
                    <tr role="row">
          
                      <th scope="col" class="nhsuk-table__header nhsuk-u-font-size-14" role="columnheader">
                        <a href="?sort=empId&direction={% if sort == 'empId' and direction == 'asc' %}desc{% else %}asc{% endif %}" class="sortableLink">
                          Employment ID
                          {% if sort == "empId" %}
                            {% if direction == "asc" %}
                              <span aria-hidden="true" class="sortable">
                                <svg width="22" height="22" focusable="false" aria-hidden="true" role="img" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                                  <path d="M6.5625 15.5L11 6.63125L15.4375 15.5H6.5625Z" fill="currentColor"></path>
                                </svg>
                              </span>
                            {% elseif direction == "desc" %}
                              <span aria-hidden="true" class="sortable">
                                <svg width="22" height="22" focusable="false" aria-hidden="true" role="img" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                                  <path d="M15.4375 7L11 15.8687L6.5625 7L15.4375 7Z" fill="currentColor"></path>
                                </svg>
                              </span>
                            {% endif %}
                          {% else %}
                              <span aria-hidden="true" class="sortable">
                                <svg width="22" height="22" focusable="false" aria-hidden="true" role="img" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                                  <path d="M8.1875 9.5L10.9609 3.95703L13.7344 9.5H8.1875Z" fill="currentColor"></path>
                                  <path d="M13.7344 12.0781L10.9609 17.6211L8.1875 12.0781H13.7344Z" fill="currentColor"></path>
                                </svg>
                              </span>
                          {% endif %}
                        </a>
                      </th>
          
                      <th scope="col" class="nhsuk-table__header nhsuk-u-font-size-14" role="columnheader">
                        <a href="?sort=start&direction={% if sort == 'start' and direction == 'asc' %}desc{% else %}asc{% endif %}" class="sortableLink">
                          Period start
                          {% if sort == "start" %}
                            {% if direction == "asc" %}
                              <span aria-hidden="true" class="sortable">
                                <svg width="22" height="22" focusable="false" aria-hidden="true" role="img" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                                  <path d="M6.5625 15.5L11 6.63125L15.4375 15.5H6.5625Z" fill="currentColor"></path>
                                </svg>
                              </span>
                            {% elseif direction == "desc" %}
                              <span aria-hidden="true" class="sortable">
                                <svg width="22" height="22" focusable="false" aria-hidden="true" role="img" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                                  <path d="M15.4375 7L11 15.8687L6.5625 7L15.4375 7Z" fill="currentColor"></path>
                                </svg>
                              </span>
                            {% endif %}
                          {% else %}
                              <span aria-hidden="true" class="sortable">
                                <svg width="22" height="22" focusable="false" aria-hidden="true" role="img" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                                  <path d="M8.1875 9.5L10.9609 3.95703L13.7344 9.5H8.1875Z" fill="currentColor"></path>
                                  <path d="M13.7344 12.0781L10.9609 17.6211L8.1875 12.0781H13.7344Z" fill="currentColor"></path>
                                </svg>
                              </span>
                          {% endif %}
                        </a>
                      </th>
                      <th scope="col" class="nhsuk-table__header nhsuk-u-font-size-14" role="columnheader">
                        <a href="?sort=end&direction={% if sort == 'end' and direction == 'asc' %}desc{% else %}asc{% endif %}" class="sortableLink">
                          Period end
                          {% if sort == "end" %}
                            {% if direction == "asc" %}
                              <span aria-hidden="true" class="sortable">
                                <svg width="22" height="22" focusable="false" aria-hidden="true" role="img" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                                  <path d="M6.5625 15.5L11 6.63125L15.4375 15.5H6.5625Z" fill="currentColor"></path>
                                </svg>
                              </span>
                            {% elseif direction == "desc" %}
                              <span aria-hidden="true" class="sortable">
                                <svg width="22" height="22" focusable="false" aria-hidden="true" role="img" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                                  <path d="M15.4375 7L11 15.8687L6.5625 7L15.4375 7Z" fill="currentColor"></path>
                                </svg>
                              </span>
                            {% endif %}
                          {% else %}
                              <span aria-hidden="true" class="sortable">
                                <svg width="22" height="22" focusable="false" aria-hidden="true" role="img" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                                  <path d="M8.1875 9.5L10.9609 3.95703L13.7344 9.5H8.1875Z" fill="currentColor"></path>
                                  <path d="M13.7344 12.0781L10.9609 17.6211L8.1875 12.0781H13.7344Z" fill="currentColor"></path>
                                </svg>
                              </span>
                          {% endif %}
                        </a>
                      </th>
                      <th scope="col" class="nhsuk-table__header nhsuk-u-font-size-14" role="columnheader">
                        Employee Conts
                      </th>
                      <th scope="col" class="nhsuk-table__header nhsuk-u-font-size-14" role="columnheader">
                        TPP
                      </th>
                      <th scope="col" class="nhsuk-table__header nhsuk-u-font-size-14" role="columnheader">
                        Employer Conts
                      </th>
                      <th scope="col" class="nhsuk-table__header nhsuk-u-font-size-14" role="columnheader">
                        Employer Pay
                      </th>
          
                    </tr>
                  </thead>
                  
                  <tbody class="nhsuk-table__body">
                    {% for row in tableData | sortBy(sort, direction) %}
                    <tr class="nhsuk-table__row {% if row.error %}errorHighlight{% else %}hidden-row{% endif %}" role="row">
                        <td class="nhsuk-table__cell nhsuk-u-font-size-14" role="cell">
                          {% if row.error %}
                            <span class="errorTxt">{{ row.empId }}</span>
                          {% else %}
                            {{ row.empId }}
                          {% endif %}
                        </td>
                        <td class="nhsuk-table__cell nhsuk-u-font-size-14" role="cell">{{ row.start }}</td>
                        <td class="nhsuk-table__cell nhsuk-u-font-size-14" role="cell">{{ row.end }}</td>
                        <td class="nhsuk-table__cell nhsuk-u-font-size-14" role="cell">{{ row.empConts }}</td>
                        <td class="nhsuk-table__cell nhsuk-u-font-size-14" role="cell">{{ row.tpp }}</td>
                        <td class="nhsuk-table__cell nhsuk-u-font-size-14" role="cell">{{ row.employerConts }}</td>
                        <td class="nhsuk-table__cell nhsuk-u-font-size-14" role="cell">{{ row.empPay }}</td>
                      </tr>
                    {% endfor %}
                  </tbody>
                </table>
            </div>
        </details>

        <!-- ****************
        HOURS HISTORY
        ***************** -->

        <details class="nhsuk-details nhsuk-expander" id="hoursHistory">
            <summary class="nhsuk-details__summary">
                <span class="nhsuk-details__summary-text">
                    Hours history
                </span>
                <strong class="nhsuk-tag nhsuk-tag--red">
                    1 issue found
                </strong>
            </summary>
            <div class="nhsuk-details__text">
                <div class="nhsuk-error-summary" aria-labelledby="error-summary-title" role="alert" tabindex="-1"
                    data-module="nhsuk-error-summary">
                    <h2 class="nhsuk-error-summary__title" id="error-summary-title">
                        Issue found
                    </h2>
                    <div class="nhsuk-error-summary__body">
                        <p>There is 1 issue in the hours history table. It must be fixed before the record can be
                            processed.</p>
                        <ul class="nhsuk-list nhsuk-error-summary__list" role="list">
                            <li> <a href="#hrsError">Employment ID 3 must appear in both service history and employment
                                    history</a></li>
                        </ul>
                    </div>
                </div>
                <button id="toggleButton" class="nhsuk-button nhsuk-button--secondary" data-module="nhsuk-button" onclick="toggleRows()">Hide correct rows</button>
                  <table class="nhsuk-table-responsive" role="table">
                      <thead class="nhsuk-table__head">
                        <tr role="row">
                          <th scope="col" class="nhsuk-table__header nhsuk-u-font-size-14" role="columnheader">
                            <a href="?sort=end&direction={% if sort == 'empidHH' and direction == 'asc' %}desc{% else %}asc{% endif %}" class="sortableLink">
                              Employment ID
                              {% if sort == "empidHH" %}
                                {% if direction == "asc" %}
                                  <span aria-hidden="true" class="sortable">
                                    <svg width="22" height="22" focusable="false" aria-hidden="true" role="img" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                                      <path d="M6.5625 15.5L11 6.63125L15.4375 15.5H6.5625Z" fill="currentColor"></path>
                                    </svg>
                                  </span>
                                {% elseif direction == "desc" %}
                                  <span aria-hidden="true" class="sortable">
                                    <svg width="22" height="22" focusable="false" aria-hidden="true" role="img" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                                      <path d="M15.4375 7L11 15.8687L6.5625 7L15.4375 7Z" fill="currentColor"></path>
                                    </svg>
                                  </span>
                                {% endif %}
                              {% else %}
                                  <span aria-hidden="true" class="sortable">
                                    <svg width="22" height="22" focusable="false" aria-hidden="true" role="img" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                                      <path d="M8.1875 9.5L10.9609 3.95703L13.7344 9.5H8.1875Z" fill="currentColor"></path>
                                      <path d="M13.7344 12.0781L10.9609 17.6211L8.1875 12.0781H13.7344Z" fill="currentColor"></path>
                                    </svg>
                                  </span>
                              {% endif %}
                            </a>
                          </th>
                          <th scope="col" class="nhsuk-table__header nhsuk-u-font-size-14" role="columnheader">
                            <a href="?sort=end&direction={% if sort == 'startHH' and direction == 'asc' %}desc{% else %}asc{% endif %}" class="sortableLink">
                              Start date
                              {% if sort == "startHH" %}
                                {% if direction == "asc" %}
                                  <span aria-hidden="true" class="sortable">
                                    <svg width="22" height="22" focusable="false" aria-hidden="true" role="img" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                                      <path d="M6.5625 15.5L11 6.63125L15.4375 15.5H6.5625Z" fill="currentColor"></path>
                                    </svg>
                                  </span>
                                {% elseif direction == "desc" %}
                                  <span aria-hidden="true" class="sortable">
                                    <svg width="22" height="22" focusable="false" aria-hidden="true" role="img" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                                      <path d="M15.4375 7L11 15.8687L6.5625 7L15.4375 7Z" fill="currentColor"></path>
                                    </svg>
                                  </span>
                                {% endif %}
                              {% else %}
                                  <span aria-hidden="true" class="sortable">
                                    <svg width="22" height="22" focusable="false" aria-hidden="true" role="img" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                                      <path d="M8.1875 9.5L10.9609 3.95703L13.7344 9.5H8.1875Z" fill="currentColor"></path>
                                      <path d="M13.7344 12.0781L10.9609 17.6211L8.1875 12.0781H13.7344Z" fill="currentColor"></path>
                                    </svg>
                                  </span>
                              {% endif %}
                            </a>
                          </th>
                          <th scope="col" class="nhsuk-table__header nhsuk-u-font-size-14" role="columnheader">
                            <a href="?sort=end&direction={% if sort == 'endHH' and direction == 'asc' %}desc{% else %}asc{% endif %}" class="sortableLink">
                              End date
                              {% if sort == "endHH" %}
                                {% if direction == "asc" %}
                                  <span aria-hidden="true" class="sortable">
                                    <svg width="22" height="22" focusable="false" aria-hidden="true" role="img" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                                      <path d="M6.5625 15.5L11 6.63125L15.4375 15.5H6.5625Z" fill="currentColor"></path>
                                    </svg>
                                  </span>
                                {% elseif direction == "desc" %}
                                  <span aria-hidden="true" class="sortable">
                                    <svg width="22" height="22" focusable="false" aria-hidden="true" role="img" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                                      <path d="M15.4375 7L11 15.8687L6.5625 7L15.4375 7Z" fill="currentColor"></path>
                                    </svg>
                                  </span>
                                {% endif %}
                              {% else %}
                                  <span aria-hidden="true" class="sortable">
                                    <svg width="22" height="22" focusable="false" aria-hidden="true" role="img" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                                      <path d="M8.1875 9.5L10.9609 3.95703L13.7344 9.5H8.1875Z" fill="currentColor"></path>
                                      <path d="M13.7344 12.0781L10.9609 17.6211L8.1875 12.0781H13.7344Z" fill="currentColor"></path>
                                    </svg>
                                  </span>
                              {% endif %}
                            </a>
                          </th>
                          <th scope="col" class="nhsuk-table__header nhsuk-u-font-size-14" role="columnheader">Part time hours
                          </th>
                        </tr>
                      </thead>
                      <tbody class="nhsuk-table__body">
                        {% for row in ptHoursData %}
                        <tr class="nhsuk-table__row {% if row.error %}errorHighlight{% else %}hidden-row{% endif %}" role="row">
                            <td class="nhsuk-table__cell nhsuk-u-font-size-14" role="cell">
                              {% if row.error %}
                                <span class="errorTxt">{{ row.empId }}</span>
                              {% else %}
                                {{ row.empId }}
                              {% endif %}
                            </td>
                            <td class="nhsuk-table__cell nhsuk-u-font-size-14" role="cell">{{ row.start }}</td>
                            <td class="nhsuk-table__cell nhsuk-u-font-size-14" role="cell">{{ row.end }}</td>
                            <td class="nhsuk-table__cell nhsuk-u-font-size-14" role="cell">{{ row.hours }}</td>
                          </tr>
                        {% endfor %}
                      </tbody>
                      
                    </table>
            </div>
        </details>

        <!-- ****************
        LINKED EMPLOYMENT
        ***************** -->


        <details class="nhsuk-details nhsuk-expander" id="linkedEmployment">
            <summary class="nhsuk-details__summary">
                <span class="nhsuk-details__summary-text">
                    Linked employment
                </span>
            </summary>
            <div class="nhsuk-details__text">
                <table class="nhsuk-table-responsive" role="table">
                    <thead class="nhsuk-table__head" role="rowgroup">
                      <tr role="row">
                          <th scope="col" class="nhsuk-table__header nhsuk-u-font-size-14" role="columnheader">Pre-remedy employment ID</th>
                          <th scope="col" class="nhsuk-table__header nhsuk-u-font-size-14" role="columnheader">Remedy employment ID</th>
                          <th scope="col" class="nhsuk-table__header nhsuk-u-font-size-14" role="columnheader">Post-remedy employment ID</th>
                      </tr>
                    </thead>
                    <tbody class="nhsuk-table__body">
                      <tr class="nhsuk-table__row" role="row">
                          <td class="nhsuk-table__cell nhsuk-u-font-size-14" role="cell"><span class="nhsuk-table-responsive__heading" aria-hidden="true">Pre-remedy employment ID </span>1</td>
                          <td class="nhsuk-table__cell nhsuk-u-font-size-14" role="cell"><span class="nhsuk-table-responsive__heading" aria-hidden="true">Remedy employment ID </span>2</td>
                          <td class="nhsuk-table__cell nhsuk-u-font-size-14" role="cell"><span class="nhsuk-table-responsive__heading" aria-hidden="true">Post-remedy employment ID </span></td>
                      </tr>
                      <tr class="nhsuk-table__row" role="row">
                          <td class="nhsuk-table__cell nhsuk-u-font-size-14" role="cell"><span class="nhsuk-table-responsive__heading" aria-hidden="true">Pre-remedy employment ID </span>3</td>
                          <td class="nhsuk-table__cell nhsuk-u-font-size-14" role="cell"><span class="nhsuk-table-responsive__heading" aria-hidden="true">Remedy employment ID </span>5</td>
                          <td class="nhsuk-table__cell nhsuk-u-font-size-14" role="cell"><span class="nhsuk-table-responsive__heading" aria-hidden="true">Post-remedy employment ID </span></td>
                      </tr>
                    </tbody>
                </table>
            </div>
        </details>

    </div>
</div>


<script>
  function toggleRows() {
    const rows = document.querySelectorAll('.hidden-row');
    const button = document.getElementById('toggleButton');
    const buttonConts = document.getElementById('toggleButtonConts');

    let anyHidden = false;

    // Toggle each row and check if any are becoming visible
    rows.forEach(row => {
      row.classList.toggle('hidden');
      if (!row.classList.contains('hidden')) {
        anyHidden = true;
      }
    });

    // Update button text based on visibility
    button.textContent = anyHidden ? 'Hide correct rows' : 'Show correct rows';
    buttonConts.textContent = anyHidden ? 'Hide correct rows' : 'Show correct rows';
  }
</script>


{% endblock %}