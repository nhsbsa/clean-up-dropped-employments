{% extends 'layout.html' %}
{% set pageTitle = "John Smith"%}

{% block pageTitle %}
{{pageTitle}} - {{serviceName}}
{% endblock %}

{% block content %}
<div class="nhsuk-grid-row">
    <div class="nhsuk-grid-column-full">

        <span class="nhsuk-caption-l">Member Details</span>
        <h1 class="nhsuk-heading-l nhsuk-u-margin-bottom-3">{{pageTitle}}</h1>
    
        <div class="nhsuk-grid-row">
          <div class="nhsuk-grid-column-one-half">
            {{ summaryList({
            rows: [
            {
            key: {
            text: "Member number"
            },
            value: {
            text: "12345678"
            }
            },
            {
            key: {
            text: "NI number"
            },
            value: {
            text: "QQ 12 34 45 D"
            }
            },
            {
            key: {
            text: "Scheme"
            },
            value: {
            html: "2015 Scheme"
            }
            }
            ]
            }) }}
          </div>
          <div class="nhsuk-grid-column-one-half">
            {{ summaryList({
            rows: [
            {
            key: {
            text: "Date of birth (Age)"
            },
            value: {
            text: "18 September 1959 (66year 02month)"
            }
            },
            {
            key: {
            text: "Status"
            },
            value: {
            html: "Active"
            }
            },
            {
            key: {
            text: "Email"
            },
            value: {
            html: 'john.smith@email.com'
            }
            }
            ]
            }) }}
          </div>
        </div>
    
        <!-- ****************
            OVERVIEW
          ***************** -->
    
        {% set notifyHtml %}
        <p>
          <b>8 validation issues</b> have been found for member 12345678
        </p>
        {% endset %}
    
        {{ insetText({
        html: notifyHtml
        }) }}
    
    
        <h2>Core member data sets</h2>
        <div class="nhsuk-hint" id="example-with-hint-text-hint">
            <p>These data sets show core member details from Compendia. You can cross-reference them in one view.</p>
            <p>Any issues are highlighted and must be fixed before the case can be processed.</p>
        </div>

        <button class="nhsuk-button nhsuk-button--secondary nhsuk-button--small" aria-expanded="false" aria-controls="filters-panel" id="filters-toggle">
          Show filters
        </button>

        <div id="filters-panel" hidden>
            <form id="table-selector-form">
              <div class="nhsuk-form-group">
                <fieldset class="nhsuk-fieldset">
                    <legend class="nhsuk-fieldset__legend nhsuk-fieldset__legend--m">
                        <h1 class="nhsuk-fieldset__heading">
                            Choose which data sets to display
                        </h1>
                  </legend>
            
                  <div class="nhsuk-checkboxes nhsuk-checkboxes--small nhsuk-checkboxes-filter" data-module="nhsuk-checkboxes">
            
                    <div class="nhsuk-checkboxes__item">
                        <input class="nhsuk-checkboxes__input" id="contsTpp-checkbox" name="tables" type="checkbox" value="contsTpp" checked>
                        <label class="nhsuk-label nhsuk-checkboxes__label" for="contsTpp-checkbox">
                          Conts &amp; TPP
                        </label>
                    </div>
            
                    <div class="nhsuk-checkboxes__item">
                      <input class="nhsuk-checkboxes__input" id="employmentHistory-checkbox" name="tables" type="checkbox" value="employmentHistory" checked>
                      <label class="nhsuk-label nhsuk-checkboxes__label" for="employmentHistory-checkbox">
                        Employment History
                      </label>
                    </div>
            
                    <div class="nhsuk-checkboxes__item">
                      <input class="nhsuk-checkboxes__input" id="hoursHistory-checkbox" name="tables" type="checkbox" value="hoursHistory" checked>
                      <label class="nhsuk-label nhsuk-checkboxes__label" for="hoursHistory-checkbox">
                        Hours history
                      </label>
                    </div>
            
                    <div class="nhsuk-checkboxes__item">
                      <input class="nhsuk-checkboxes__input" id="linkedEmployment-checkbox" name="tables" type="checkbox" value="linkedEmployment" checked>
                      <label class="nhsuk-label nhsuk-checkboxes__label" for="linkedEmployment-checkbox">
                        Linked employment
                      </label>
                    </div>
            
                    <div class="nhsuk-checkboxes__item">
                      <input class="nhsuk-checkboxes__input" id="serviceGroup-checkbox" name="tables" type="checkbox" value="serviceGroup" checked>
                      <label class="nhsuk-label nhsuk-checkboxes__label" for="serviceGroup-checkbox">
                        Service group
                      </label>
                    </div>

                    <div class="nhsuk-checkboxes__item">
                      <input class="nhsuk-checkboxes__input" id="serviceHistory-checkbox" name="tables" type="checkbox" value="serviceHistory" checked>
                      <label class="nhsuk-label nhsuk-checkboxes__label" for="serviceHistory-checkbox">
                        Service history
                      </label>
                    </div>
            
                  </div>
                </fieldset>
              </div>
            
              <button class="nhsuk-button" type="submit">Apply filters</button>
            </form>
        </div>
        

        <!-- ****************
        SERVICE HISTORY
        ***************** -->

        <details class="nhsuk-details nhsuk-expander" id="serviceHistory">
        <summary class="nhsuk-details__summary">
            <span class="nhsuk-details__summary-text">
                Service history
            </span>
            <strong class="nhsuk-tag nhsuk-tag--red">
                4 issues found
            </strong>
        </summary>
        <div class="nhsuk-details__text">
            {{ serviceHistoryErrors | safe }}
            {{ serviceHistoryTable | safe }}
        </div>
        </details>

        <!-- ****************
          SERVICE GROUP
        ***************** -->

        <details class="nhsuk-details nhsuk-expander" id="serviceGroup">
            <summary class="nhsuk-details__summary">
                <span class="nhsuk-details__summary-text">
                    Service group
                </span>
            </summary>
            <div class="nhsuk-details__text">
                {{ serviceGroupTable | safe }}
            </div>
        </details>

        <!-- ****************
        EMPLOYMENT HISTORY
        ***************** -->

        <details class="nhsuk-details nhsuk-expander" id="employmentHistory">
            <summary class="nhsuk-details__summary">
                <span class="nhsuk-details__summary-text">
                    Employment history
                </span>
                <strong class="nhsuk-tag nhsuk-tag--red">
                    2 issues found
                </strong>
            </summary>
            <div class="nhsuk-details__text">
                {{ employmentHistoryErrors | safe }}
                {{ employmentHistoryTable | safe }}
            </div>
        </details>


        <!-- ****************
        PENSION CONTRIBUTIONS
        ***************** -->

        <details class="nhsuk-details nhsuk-expander" id="contsTpp">
            <summary class="nhsuk-details__summary">
                <span class="nhsuk-details__summary-text">
                    Conts &amp; TPP (Pension contributions)
                </span>
                <strong class="nhsuk-tag nhsuk-tag--red">
                    1 issue found
                </strong>
            </summary>
            <div class="nhsuk-details__text">
                {{ contsTppErrors | safe }}
                <button id="toggleButtonConts" class="nhsuk-button nhsuk-button--secondary nhsuk-button--small" data-module="nhsuk-button"
                    onclick="toggleRows()">Hide correct rows</button>
                {{ contsTppTable | safe }}
            </div>
        </details>

        <!-- ****************
        HOURS HISTORY
        ***************** -->

        <details class="nhsuk-details nhsuk-expander" id="hoursHistory">
            <summary class="nhsuk-details__summary">
                <span class="nhsuk-details__summary-text">
                    Hours history
                </span>
                <strong class="nhsuk-tag nhsuk-tag--red">
                    1 issue found
                </strong>
            </summary>
            <div class="nhsuk-details__text">
                {{ hoursHistoryErrors | safe }}
                <button id="toggleButton" class="nhsuk-button nhsuk-button--secondary nhsuk-button--small" data-module="nhsuk-button"
                    onclick="toggleRows()">Hide correct rows</button>
                {{ hoursHistoryTable | safe }}
            </div>
        </details>

        <!-- ****************
        LINKED EMPLOYMENT
        ***************** -->

        <details class="nhsuk-details nhsuk-expander" id="linkedEmployment">
            <summary class="nhsuk-details__summary">
                <span class="nhsuk-details__summary-text">
                    Linked employment
                </span>
            </summary>
            <div class="nhsuk-details__text">
                {{ linkedEmploymentTable | safe }}
            </div>
        </details>

    </div>
</div>

<script src="/js/filter.js"></script>
<script>
  function toggleRows() {
    const rows = document.querySelectorAll('.hidden-row');
    const button = document.getElementById('toggleButton');
    const buttonConts = document.getElementById('toggleButtonConts');

    let anyHidden = false;

    // Toggle each row and check if any are becoming visible
    rows.forEach(row => {
      row.classList.toggle('hidden');
      if (!row.classList.contains('hidden')) {
        anyHidden = true;
      }
    });

    // Update button text based on visibility
    button.textContent = anyHidden ? 'Hide correct rows' : 'Show all rows';
    buttonConts.textContent = anyHidden ? 'Hide correct rows' : 'Show all rows';
  }
</script>

{% endblock %}