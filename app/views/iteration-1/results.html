{% extends 'layout.html' %}
{% set pageTitle = "John Smith"%}

{% block pageTitle %}
{{pageTitle}} - {{serviceName}}
{% endblock %}

{% block content %}
<div class="nhsuk-grid-row">
    <div class="nhsuk-grid-column-full">

        <span class="nhsuk-caption-l">Member Details</span>
        <h1 class="nhsuk-heading-l nhsuk-u-margin-bottom-3">{{pageTitle}}</h1>

        <div class="nhsuk-grid-row">
            <div class="nhsuk-grid-column-one-half">
                {{ summaryList({
                rows: [
                {
                key: {
                text: "Member number"
                },
                value: {
                text: "12345678"
                }
                },
                {
                key: {
                text: "NI number"
                },
                value: {
                text: "QQ 12 34 45 D"
                }
                },
                {
                key: {
                text: "Scheme"
                },
                value: {
                html: "2015 Scheme"
                }
                }
                ]
                }) }}
            </div>
            <div class="nhsuk-grid-column-one-half">
                {{ summaryList({
                rows: [
                {
                key: {
                text: "Date of birth (Age)"
                },
                value: {
                text: "18 September 1959 (66year 02month)"
                }
                },
                {
                key: {
                text: "Status"
                },
                value: {
                html: "Active"
                }
                },
                {
                key: {
                text: "Email"
                },
                value: {
                html: 'john.smith@email.com'
                }
                }
                ]
                }) }}
            </div>
        </div>

        <!-- ****************
        OVERVIEW
      ***************** -->

        {% set notifyHtml %}
        <p>
            <b>8 validation issues</b> have been found for member 12345678
        </p>
        {% endset %}

        {{ insetText({
        html: notifyHtml
        }) }}


        <h2>Core member data sets</h2>
        <div class="nhsuk-hint" id="example-with-hint-text-hint">
            <p>These data sets show core member details from Compendia.They are live and update each time you refresh the page.</p>
            <p>You can cross-reference them in one view.</p>
            <p>Any issues are highlighted and must be fixed before the case can be processed.</p>
        </div>

        <!-- ****************
        SERVICE HISTORY
        ***************** -->

        <details class="nhsuk-details nhsuk-expander">
            <summary class="nhsuk-details__summary">
                <span class="nhsuk-details__summary-text">
                    Service history
                </span>
                <strong class="nhsuk-tag nhsuk-tag--red">
                    4 issues found
                </strong>
            </summary>
            <div class="nhsuk-details__text">
                {{ serviceHistoryErrors | safe }}
                <button id="toggleButtonSh" class="nhsuk-button nhsuk-button--secondary nhsuk-button--small" data-module="nhsuk-button"
                    onclick="toggleRows('rows-sh', this)">Hide correct rows</button>
                {{ serviceHistoryTable | safe }}
            </div>
        </details>

        <!-- ****************
          SERVICE GROUP
        ***************** -->

        <details class="nhsuk-details nhsuk-expander">
            <summary class="nhsuk-details__summary">
                <span class="nhsuk-details__summary-text">
                    Service group
                </span>
            </summary>
            <div class="nhsuk-details__text">
                {{ serviceGroupTable | safe }}
            </div>
        </details>

        <!-- ****************
        EMPLOYMENT HISTORY
        ***************** -->

        <details class="nhsuk-details nhsuk-expander">
            <summary class="nhsuk-details__summary">
                <span class="nhsuk-details__summary-text">
                    Employment history
                </span>
                <strong class="nhsuk-tag nhsuk-tag--red">
                    2 issues found
                </strong>
            </summary>
            <div class="nhsuk-details__text">
                <div class="nhsuk-error-summary" aria-labelledby="error-summary-title" role="alert" tabindex="-1" data-module="nhsuk-error-summary">
                    <h2 class="nhsuk-error-summary__title" id="error-summary-title">
                        Issues found
                    </h2>
                    <div class="nhsuk-error-summary__body">
                        <p>There are 2 issues in the employment history table. They must be fixed before the record can be processed.Â </p>
                        <ul class="nhsuk-list nhsuk-error-summary__list" role="list">
                        <li> <a href="#ehError1">Employment ID 3 must appear in both service history and employment history</a></li>
                        <li> <a href="#ehError2">Employment ID 5 must appear in both service history and employment history</a></li>
                        </ul>
                    </div>
                </div>
                <button id="toggleButtonEh" class="nhsuk-button nhsuk-button--secondary nhsuk-button--small" data-module="nhsuk-button"
                    onclick="toggleRows('rows-eh', this)">Hide correct rows</button>
                <div class="nhsuk-hint">You can scroll left and right to see all columns if the table does not fit on your screen</div>
                <div class="nhsuk-scrollable-pane" aria-label="Employment history" tabindex="0">
                <table class="nhsuk-table" role="table">
                    <caption class="nhsuk-u-visually-hidden">Employment history table</caption>
                    <thead class="nhsuk-table__head" role="rowgroup">
                        <tr role="row">
                        <th scope="col" class="ehEmpID nhsuk-table__header nhsuk-u-font-size-14" role="columnheader">Employment ID</th>
                        <th scope="col" class="ehEmpCode nhsuk-table__header nhsuk-u-font-size-14" role="columnheader">Employer code</th>
                        <th scope="col" class="ehStart nhsuk-table__header nhsuk-u-font-size-14" role="columnheader">Start date</th>
                        <th scope="col" class="ehEnd nhsuk-u-font-size-14" role="columnheader">End date</th>
                        <th scope="col" class="ehTime nhsuk-table__header nhsuk-u-font-size-14" role="columnheader">Whole/part time</th>
                        <th scope="col" class="ehCapCode nhsuk-table__header nhsuk-u-font-size-14" role="columnheader">Capacity code</th>
                        <th scope="col" class="ehEmpType nhsuk-table__header nhsuk-u-font-size-14" role="columnheader">Employment type</th>
                        <th scope="col" class="ehActHrs nhsuk-table__header nhsuk-u-font-size-14" role="columnheader">Actual hours</th>
                        <th scope="col" class="ehStdHrs nhsuk-table__header nhsuk-u-font-size-14" role="columnheader">Standard hours</th>
                    </tr>
                    </thead>
                    <tbody class="nhsuk-table__body">
                        <tr class="nhsuk-table__row rows-eh hidden-row" role="row">
                            <td class="ehEmpID nhsuk-table__cell nhsuk-u-font-size-14" role="cell">1</td>
                            <td class="ehEmpCode nhsuk-table__cell nhsuk-u-font-size-14" role="cell">5266</td>
                            <td class="ehStart nhsuk-table__cell nhsuk-u-font-size-14" role="cell">01/04/2013</td>
                            <td class="ehEnd nhsuk-table__cell nhsuk-u-font-size-14" role="cell">09/11/2014</td>
                            <td class="ehTime nhsuk-table__cell nhsuk-u-font-size-14" role="cell">Whole time</td>
                            <td class="ehCapCode nhsuk-table__cell nhsuk-u-font-size-14" role="cell">1</td>
                            <td class="ehEmpType nhsuk-table__cell nhsuk-u-font-size-14" role="cell">8</td>
                            <td class="ehActHrs nhsuk-table__cell nhsuk-u-font-size-14" role="cell">&nbsp;</td>
                            <td class="ehStdHrs nhsuk-u-font-size-14" role="cell">&nbsp;</td>
                        </tr>
                        <tr class="nhsuk-table__row rows-eh hidden-row" role="row">
                            <td class="ehEmpID nhsuk-table__cell nhsuk-u-font-size-14" role="cell">1</td>
                            <td class="ehEmpCode nhsuk-table__cell nhsuk-u-font-size-14" role="cell">5266</td>
                            <td class="ehStart nhsuk-table__cell nhsuk-u-font-size-14" role="cell">10/11/2014</td>
                            <td class="ehEnd nhsuk-table__cell nhsuk-u-font-size-14" role="cell">31/03/2015</td>
                            <td class="ehTime nhsuk-table__cell nhsuk-u-font-size-14" role="cell">Part time</td>
                            <td class="ehCapCode nhsuk-table__cell nhsuk-u-font-size-14" role="cell">1</td>
                            <td class="ehEmpType nhsuk-table__cell nhsuk-u-font-size-14" role="cell">8</td>
                            <td class="ehActHrs nhsuk-table__cell nhsuk-u-font-size-14" role="cell">30</td>
                            <td class="ehStdHrs nhsuk-u-font-size-14" role="cell">37.5</td>
                        </tr>
                        <tr class="nhsuk-table__row rows-eh hidden-row" role="row">
                            <td class="ehEmpID nhsuk-table__cell nhsuk-u-font-size-14" role="cell">2</td>
                            <td class="ehEmpCode nhsuk-table__cell nhsuk-u-font-size-14" role="cell">5266</td>
                            <td class="ehStart nhsuk-table__cell nhsuk-u-font-size-14" role="cell">01/04/2015</td>
                            <td class="ehEnd nhsuk-table__cell nhsuk-u-font-size-14" role="cell"></td>
                            <td class="ehTime nhsuk-table__cell nhsuk-u-font-size-14" role="cell">Part time</td>
                            <td class="ehCapCode nhsuk-table__cell nhsuk-u-font-size-14" role="cell">1</td>
                            <td class="ehEmpType nhsuk-table__cell nhsuk-u-font-size-14" role="cell">8</td>
                            <td class="ehActHrs nhsuk-table__cell nhsuk-u-font-size-14" role="cell">30</td>
                            <td class="ehStdHrs nhsuk-u-font-size-14" role="cell">37.5</td>
                        </tr>
                        <tr class="nhsuk-table__row errorHighlight" id="ehError1" role="row">
                            <td colspan="100%" class="ehEmpID nhsuk-table__cell nhsuk-u-font-size-14" role="cell"><button class="button--error" aria-label="Error: Employment ID 3 must appear in both service history and employment history">Missing employment ID - no data</button></td>
                        </tr>
                        <tr class="nhsuk-table__row errorHighlight" role="row" id="ehError2">
                            <td colspan="100%" class="ehEmpID nhsuk-table__cell nhsuk-u-font-size-14" role="cell"><button class="button--error" aria-label="Error: Employment ID 5 must appear in both service history and employment history">Missing employment ID - no data</button></td>
                        </tr>
                    </tbody>
                </table>
                </div> 
            </div>
        </details>


        <!-- ****************
        PENSION CONTRIBUTIONS
        ***************** -->

        <details class="nhsuk-details nhsuk-expander">
            <summary class="nhsuk-details__summary">
                <span class="nhsuk-details__summary-text">
                    Conts &amp; TPP (Pension contributions)
                </span>
                <strong class="nhsuk-tag nhsuk-tag--red">
                    1 issue found
                </strong>
            </summary>
            <div class="nhsuk-details__text">
                {{ contsTppErrors | safe }}
                <button id="toggleButtonConts" class="nhsuk-button nhsuk-button--secondary nhsuk-button--small" data-module="nhsuk-button"
                    onclick="toggleRows('rows-conts', this)">Hide correct rows</button>
                {{ contsTppTable | safe }}
            </div>
        </details>

        <!-- ****************
        HOURS HISTORY
        ***************** -->

        <details class="nhsuk-details nhsuk-expander">
            <summary class="nhsuk-details__summary">
                <span class="nhsuk-details__summary-text">
                    Hours history
                </span>
                <strong class="nhsuk-tag nhsuk-tag--red">
                    1 issue found
                </strong>
            </summary>
            <div class="nhsuk-details__text">
                {{ hoursHistoryErrors | safe }}
                <button id="toggleButton" class="nhsuk-button nhsuk-button--secondary nhsuk-button--small" data-module="nhsuk-button"
                    onclick="toggleRows('rows-hh', this)">Hide correct rows</button>
                {{ hoursHistoryTable | safe }}
            </div>
        </details>

        <!-- ****************
        LINKED EMPLOYMENT
        ***************** -->

        <details class="nhsuk-details nhsuk-expander">
            <summary class="nhsuk-details__summary">
                <span class="nhsuk-details__summary-text">
                    Linked employment
                </span>
            </summary>
            <div class="nhsuk-details__text">
                {{ linkedEmploymentTable | safe }}
            </div>
        </details>

    </div>
</div>

<script>
  function toggleRows(groupClass, button) {
    const rows = document.querySelectorAll(`.${groupClass}`);
    let anyVisible = false;

    rows.forEach(row => {
      row.classList.toggle('hidden');
      if (!row.classList.contains('hidden')) {
        anyVisible = true;
      }
    });

    button.textContent = anyVisible
      ? 'Hide correct rows'
      : 'Show all rows';
  }
</script>
{% endblock %}