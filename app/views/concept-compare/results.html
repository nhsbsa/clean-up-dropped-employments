{% extends 'layout.html' %}
{% set pageTitle = "John Smith"%}

{% block pageTitle %}
{{pageTitle}} - {{serviceName}}
{% endblock %}

{% block content %}
<div class="nhsuk-grid-row">
  <div class="nhsuk-grid-column-full">

    <span class="nhsuk-caption-l">Member Details</span>
    <h1 class="nhsuk-heading-l nhsuk-u-margin-bottom-3">{{pageTitle}}</h1>

    <div class="nhsuk-grid-row">
      <div class="nhsuk-grid-column-one-half">
        {{ summaryList({
        rows: [
        {
        key: {
        text: "Member number"
        },
        value: {
        text: "12345678"
        }
        },
        {
        key: {
        text: "NI number"
        },
        value: {
        text: "QQ 12 34 45 D"
        }
        },
        {
        key: {
        text: "Scheme"
        },
        value: {
        html: "2015 Scheme"
        }
        }
        ]
        }) }}
      </div>
      <div class="nhsuk-grid-column-one-half">
        {{ summaryList({
        rows: [
        {
        key: {
        text: "Date of birth (Age)"
        },
        value: {
        text: "18 September 1959 (66year 02month)"
        }
        },
        {
        key: {
        text: "Status"
        },
        value: {
        html: "Active"
        }
        },
        {
        key: {
        text: "Email"
        },
        value: {
        html: 'john.smith@email.com'
        }
        }
        ]
        }) }}
      </div>
    </div>

    <!-- ****************
        OVERVIEW
      ***************** -->

    {% set notifyHtml %}
    <p>
      <b>8 validation issues</b> have been found for member 12345678
    </p>
    {% endset %}

    {{ insetText({
    html: notifyHtml
    }) }}


    <h2>Core member data sets</h2>
    <div class="nhsuk-hint" id="example-with-hint-text-hint">
        <p>These data sets show core member details from Compendia. You can cross-reference them in one view.</p>
        <p>Any issues are highlighted and must be fixed before the case can be processed.</p>
    </div>

    <button class="nhsuk-button nhsuk-button--secondary nhsuk-button--small" aria-expanded="false" aria-controls="filters-panel" id="filters-toggle">
      Compare data sets
    </button>

    <div id="filters-panel" hidden>
        <form id="compare-form" action="/{{folder}}/results" method="post" >
          <div class="nhsuk-form-group">
            <fieldset class="nhsuk-fieldset">
                <legend class="nhsuk-fieldset__legend nhsuk-fieldset__legend--m">
                    <h1 class="nhsuk-fieldset__heading">
                        Choose which two data sets you would like to compare
                    </h1>
              </legend>
              <div id="checkboxError" class="error nhsuk-error-message" style="display:none; color:#d5281b; margin-top:10px;">
                  <span class="nhsuk-u-visually-hidden">Error:</span> You can select a maximum of 2 options.
              </div>
        
              <div class="nhsuk-checkboxes nhsuk-checkboxes--small nhsuk-checkboxes-filter" data-module="nhsuk-checkboxes">
        
                <div class="nhsuk-checkboxes__item">
                    <input class="nhsuk-checkboxes__input" id="contsTpp-checkbox" name="contsTpp" type="checkbox" value="contsTpp" >
                    <label class="nhsuk-label nhsuk-checkboxes__label" for="contsTpp-checkbox">
                      Conts &amp; TPP
                    </label>
                </div>
        
                <div class="nhsuk-checkboxes__item">
                  <input class="nhsuk-checkboxes__input" id="employmentHistory-checkbox" name="employmentHistory" type="checkbox" value="employmentHistory" >
                  <label class="nhsuk-label nhsuk-checkboxes__label" for="employmentHistory-checkbox">
                    Employment History
                  </label>
                </div>
        
                <div class="nhsuk-checkboxes__item">
                  <input class="nhsuk-checkboxes__input" id="hoursHistory-checkbox" name="hoursHistory" type="checkbox" value="hoursHistory" >
                  <label class="nhsuk-label nhsuk-checkboxes__label" for="hoursHistory-checkbox">
                    Hours history
                  </label>
                </div>
        
                <div class="nhsuk-checkboxes__item">
                  <input class="nhsuk-checkboxes__input" id="linkedEmployment-checkbox" name="linkedEmployment" type="checkbox" value="linkedEmployment" >
                  <label class="nhsuk-label nhsuk-checkboxes__label" for="linkedEmployment-checkbox">
                    Linked employment
                  </label>
                </div>
        
                <div class="nhsuk-checkboxes__item">
                  <input class="nhsuk-checkboxes__input" id="serviceGroup-checkbox" name="serviceGroup" type="checkbox" value="serviceGroup" >
                  <label class="nhsuk-label nhsuk-checkboxes__label" for="serviceGroup-checkbox">
                    Service group
                  </label>
                </div>

                <div class="nhsuk-checkboxes__item">
                  <input class="nhsuk-checkboxes__input" id="serviceHistory-checkbox" name="serviceHistory" type="checkbox" value="serviceHistory" >
                  <label class="nhsuk-label nhsuk-checkboxes__label" for="serviceHistory-checkbox">
                    Service history
                  </label>
                </div>
        
              </div>
            </fieldset>
          </div>
        
            <button class="nhsuk-button" data-module="nhsuk-button" type="submit">Compare</button> 
        </form>
    </div>

    <!-- ****************
    SERVICE HISTORY
    ***************** -->

    <details class="nhsuk-details nhsuk-expander">
      <summary class="nhsuk-details__summary">
          <span class="nhsuk-details__summary-text">
              Service history
          </span>
          <strong class="nhsuk-tag nhsuk-tag--red">
              4 issues found
          </strong>
      </summary>
      <div class="nhsuk-details__text">
          {{ serviceHistoryErrors | safe }}
          {{ serviceHistoryTable | safe }}
      </div>
    </details>

    <!-- ****************
      SERVICE GROUP
    ***************** -->

    <details class="nhsuk-details nhsuk-expander">
        <summary class="nhsuk-details__summary">
            <span class="nhsuk-details__summary-text">
                Service group
            </span>
        </summary>
        <div class="nhsuk-details__text">
            {{ serviceGroupTable | safe }}
        </div>
    </details>

    <!-- ****************
    EMPLOYMENT HISTORY
    ***************** -->

    <details class="nhsuk-details nhsuk-expander">
        <summary class="nhsuk-details__summary">
            <span class="nhsuk-details__summary-text">
                Employment history
            </span>
            <strong class="nhsuk-tag nhsuk-tag--red">
                2 issues found
            </strong>
        </summary>
        <div class="nhsuk-details__text">
            {{ employmentHistoryErrors | safe }}
            {{ employmentHistoryTable | safe }}
        </div>
    </details>


    <!-- ****************
    PENSION CONTRIBUTIONS
    ***************** -->

    <details class="nhsuk-details nhsuk-expander">
        <summary class="nhsuk-details__summary">
            <span class="nhsuk-details__summary-text">
                Conts &amp; TPP (Pension contributions)
            </span>
            <strong class="nhsuk-tag nhsuk-tag--red">
                1 issue found
            </strong>
        </summary>
        <div class="nhsuk-details__text">
            {{ contsTppErrors | safe }}
            <button id="toggleButtonConts" class="nhsuk-button nhsuk-button--secondary nhsuk-button--small" data-module="nhsuk-button"
                onclick="toggleRows()">Hide correct rows</button>
            {{ contsTppTable | safe }}
        </div>
    </details>

    <!-- ****************
    HOURS HISTORY
    ***************** -->

    <details class="nhsuk-details nhsuk-expander">
        <summary class="nhsuk-details__summary">
            <span class="nhsuk-details__summary-text">
                Hours history
            </span>
            <strong class="nhsuk-tag nhsuk-tag--red">
                1 issue found
            </strong>
        </summary>
        <div class="nhsuk-details__text">
            {{ hoursHistoryErrors | safe }}
            <button id="toggleButton" class="nhsuk-button nhsuk-button--secondary nhsuk-button--small" data-module="nhsuk-button"
                onclick="toggleRows()">Hide correct rows</button>
            {{ hoursHistoryTable | safe }}
        </div>
    </details>

    <!-- ****************
    LINKED EMPLOYMENT
    ***************** -->

    <details class="nhsuk-details nhsuk-expander">
        <summary class="nhsuk-details__summary">
            <span class="nhsuk-details__summary-text">
                Linked employment
            </span>
        </summary>
        <div class="nhsuk-details__text">
            {{ linkedEmploymentTable | safe }}
        </div>
    </details>

  </div>
</div>

<script src="/js/compare.js"></script>

<script>
    function toggleRows() {
      const rows = document.querySelectorAll('.hidden-row');
      const button = document.getElementById('toggleButton');
      const buttonConts = document.getElementById('toggleButtonConts');
  
      let anyHidden = false;
  
      // Toggle each row and check if any are becoming visible
      rows.forEach(row => {
        row.classList.toggle('hidden');
        if (!row.classList.contains('hidden')) {
          anyHidden = true;
        }
      });
  
      // Update button text based on visibility
      button.textContent = anyHidden ? 'Hide correct rows' : 'Show all rows';
      buttonConts.textContent = anyHidden ? 'Hide correct rows' : 'Show all rows';
    }
</script>
{% endblock %}